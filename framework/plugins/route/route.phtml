<?php

namespace FunCom\Plugins\Route;

use FunCom\Components\View;
use FunCom\Plugins\Router\RouterService;
use FunCom\Registry\Registry;

use function FunCom\Hooks\useEffect;

function Route($props)
{
    useEffect(function () use($props) {
        $routeBuilder = new RouteBuilder($props);
        $route = $routeBuilder->build();

        $router = new RouterService();
        $router->addRoute($route->getMethod(), $route->getRule(), $route->getRedirect());
        $router->saveRoutes();

        $routes = Registry::item('router')['routes'];
        array_shift($routes);
        Registry::write('router', 'routes', $routes);
        
        if(count($routes) === 0) {
            rename(CACHE_DIR . 'routeregistry.json', CACHE_DIR . 'routes.json');
        }

        $match = $router->matchRoute($route);

        if($match !== null) {
            list($path, $query) = $match;
            View::render($path);
        }

    });

    return (<<<HTML
        
    HTML);
}
